<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Routing & Middleware - Laravel Mastery</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Prompt:wght@300;400;500;600&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Prism.js for Syntax Highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup-templating.min.js"></script>
    <style>
        .sidebar {
            background-color: var(--sidebar-bg);
        }

        .content {
            margin-left: 280px;
        }

        @media (max-width: 992px) {
            .content {
                margin-left: 0;
            }
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <i class="fab fa-laravel logo-icon"></i>
                <span class="logo-text">Laravel Mastery</span>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="../index.html"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="installation.html"><i class="fas fa-download"></i> การติดตั้ง</a></li>
                    <li><a href="routing-advanced.html" class="active"><i class="fas fa-route"></i> Routing &
                            Middleware</a></li>
                    <li><a href="mvc-controllers.html"><i class="fas fa-code-branch"></i> MVC & Controllers</a></li>
                    <li><a href="database-migrations.html"><i class="fas fa-database"></i> Database & Migration</a></li>
                    <li><a href="eloquent-orm.html"><i class="fas fa-server"></i> Eloquent & Relations</a></li>
                    <li><a href="blade-templating.html"><i class="fas fa-paint-brush"></i> Blade Template</a></li>
                    <li><a href="validation-requests.html"><i class="fas fa-check-circle"></i> Validation & Requests</a>
                    </li>
                    <li><a href="api-development.html"><i class="fas fa-cloud"></i> API Development</a></li>
                    <li><a href="auth-kits.html"><i class="fas fa-user-shield"></i> Auth Starter Kits</a></li>
                    <li><a href="file-storage.html"><i class="fas fa-folder-open"></i> File Storage</a></li>
                    <li><a href="mail-notifications.html"><i class="fas fa-envelope"></i> Mail & Notifications</a></li>
                    <li><a href="localization.html"><i class="fas fa-language"></i> Localization (i18n)</a></li>
                    <li><a href="collections-helpers.html"><i class="fas fa-tools"></i> Collections & Helpers</a></li>
                    <li><a href="error-logging.html"><i class="fas fa-exclamation-triangle"></i> Error & Logging</a>
                    </li>
                    <li><a href="crud-full-example.html"><i class="fas fa-check-double"></i> โปรเจกต์ CRUD</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <header class="mobile-header">
                <button id="menu-toggle"><i class="fas fa-bars"></i></button>
                <span class="logo-text">Laravel Mastery</span>
            </header>

            <div class="section">
                <h1>Routing & Middleware</h1>
                <p>ในบทนี้เราจะเรียนรู้เรื่องการจัดการเส้นทาง (Routes) ตั้งแต่พื้นฐานไปจนถึงระดับสูง พร้อมการใช้
                    Middleware เพื่อควบคุมการเข้าถึง</p>

                <hr style="margin: 2rem 0; border: 0; border-top: 1px solid var(--border-color);">

                <h2>1. พื้นฐานการเขียน Route</h2>
                <p>ไฟล์หลักสำหรับเขียน Route ของหน้าเว็บคือ <code>routes/web.php</code> โดยเราสามารถกำหนด Method ต่างๆ
                    ได้ดังนี้:</p>
                <pre><code class="language-php">use Illuminate\Support\Facades\Route;

// 1. แบบ GET: รับค่ามาแสดงผล
Route::get('/welcome', function () {
    return view('welcome');
});

// 2. แบบ POST: ส่งข้อมูลจากฟอร์ม
Route::post('/submit', [FormController::class, 'store']);

// 3. แบบ PUT/PATCH: แก้ไขข้อมูล
Route::put('/user/{id}', [UserController::class, 'update']);

// 4. แบบ DELETE: ลบข้อมูล
Route::delete('/user/{id}', [UserController::class, 'destroy']);</code></pre>

                <h2>2. การรับค่าจาก URL (Route Parameters)</h2>
                <p>เราสามารถส่งค่าผ่าน URL และนำไปใช้งานใน Controller ได้ง่ายๆ</p>
                <pre><code class="language-php">// บังคับว่าต้องมี ID
Route::get('/post/{id}', function ($id) {
    return 'Post ID คือ ' . $id;
});

// แบบ Optional (มีหรือไม่มีก็ได้)
Route::get('/user/{name?}', function ($name = 'Guest') {
    return 'สวัสดีคุณ ' . $name;
});</code></pre>

                <h2>3. การตั้งชื่อ Route (Named Routes)</h2>
                <p>ข้อดีคือเมื่อเราเปลี่ยน URL ในอนาคต เราไม่ต้องตามไปแก้ในทุกลิงก์ของเว็บ</p>
                <pre><code class="language-php">Route::get('/user/profile/settings', [ProfileController::class, 'show'])->name('profile.settings');

// วิธีเรียกใช้ใน Blade Template
// &lt;a href="{{ route('profile.settings') }}"&gt;ไปหน้าตั้งค่า&lt;/a&gt;</code></pre>

                <hr style="margin: 2rem 0; border: 0; border-top: 1px solid var(--border-color);">

                <h2>4. Route Groups & Prefix</h2>
                <p>เมื่อโปรเจกต์ใหญ่ขึ้น เราต้องการแยกกลุ่ม URL ให้เป็นระเบียบ เช่น ระบบ Admin</p>
                <pre><code class="language-php">// routes/web.php

use App\Http\Controllers\Admin\DashboardController;

Route::prefix('admin')->name('admin.')->group(function () {
    // URL จะเป็น /admin/dashboard
    // Name จะเป็น admin.dashboard
    Route::get('/dashboard', [DashboardController::class, 'index'])->name('dashboard');
    
    Route::get('/users', [UserController::class, 'index'])->name('users');
});</code></pre>
                <p>การใช้ <code>prefix</code> ช่วยประหยัดเวลาไม่ต้องพิมพ์คำว่า <code>/admin</code> ซ้ำๆ และ
                    <code>name</code> ช่วยให้การเรียกใช้ <code>route('admin.dashboard')</code> ใน View ง่ายขึ้นมาก
                </p>

                <h2>2. Middleware คืออะไร?</h2>
                <p>มันคือ "คนเฝ้าประตู" ที่จะคอยเช็ค Request ก่อนจะส่งต่อไปยัง Controller เช่น เช็คว่าล็อกอินหรือยัง?
                    หรือเป็น Admin หรือเปล่า?</p>

                <h3>การใช้งาน Middleware พื้นฐาน</h3>
                <pre><code class="language-php">Route::get('/profile', function () {
    // ...
})->middleware('auth');</code></pre>

                <h3>การสร้าง Custom Middleware</h3>
                <pre><code class="language-php">// ใช้คำสั่ง Artisan
php artisan make:middleware CheckIsAdmin</code></pre>

                <p>ตัวอย่างโค้ดใน <code>app/Http/Middleware/CheckIsAdmin.php</code>:</p>
                <pre><code class="language-php">public function handle(Request $request, Closure $next)
{
    if (auth()->user() && auth()->user()->is_admin) {
        return $next($request); // อนุญาตให้ไปต่อ
    }

    return redirect('/')->with('error', 'คุณไม่มีสิทธิ์เข้าถึงหน้านี้');
}</code></pre>

                <h2>3. การจัดกลุ่ม Route ด้วย Middleware</h2>
                <p>เราสามารถสั่งให้ทั้งกลุ่ม Route ต้องผ่าน Middleware เดียวกันได้</p>
                <pre><code class="language-php">Route::middleware(['auth', 'admin'])->group(function () {
    Route::get('/admin/settings', [SettingController::class, 'index']);
    Route::post('/admin/settings', [SettingController::class, 'update']);
});</code></pre>

                <div class="highlight-box">
                    <strong>Pro Tip:</strong> คุณสามารถกำหนด Middleware ให้กับ Controller โดยตรงใน Method
                    <code>__construct()</code> ได้เช่นกัน
                </div>
            </div>

            <div class="section">
                <div style="display: flex; justify-content: space-between;">
                    <a href="installation.html" class="btn btn-outline"><i class="fas fa-arrow-left"></i>
                        บทเรียนก่อนหน้า</a>
                    <a href="mvc-controllers.html" class="btn btn-primary">เรียนรู้ MVC ต่อ <i
                            class="fas fa-arrow-right"></i></a>
                </div>
            </div>

            <footer class="footer">
                <p>&copy; 2026 Laravel Mastery Tutorial. เจาะลึกระบบ Routing</p>
            </footer>
        </main>
    </div>
    <script src="../js/script.js"></script>
</body>

</html>